{% extends "base.html" %}

{% block title %}Fathom - {{ symbol }} Analysis{% endblock %}

{% block content %}
<div class="stock-header">
    <div class="stock-title">
        <h1>{{ symbol }}</h1>
        <p>
            {% if symbol == 'C' %}
            Citigroup Inc. ‚Ä¢ Financial
            {% elif symbol == 'XOM' %}
            Exxon Mobil ‚Ä¢ Energy
            {% elif symbol == 'NEM' %}
            Newmont Corp. ‚Ä¢ Materials
            {% endif %}
        </p>
    </div>
    <div class="current-price" id="priceDisplay">
        <div class="price-label">Loading price...</div>
        <div class="price-value">---</div>
    </div>
</div>

<div id="loading" class="loading">Loading analysis...</div>

<div id="metricsContainer" style="display: none;">
    <div class="metrics-grid" id="metricsGrid"></div>

    <div class="action-buttons">
        <button class="btn btn-primary" onclick="fetchData()">üîÑ Refresh Data</button>
        <a href="/" class="btn btn-secondary">‚Üê Back to Stocks</a>
    </div>
</div>

<script>
    const symbol = '{{ symbol }}';

    async function fetchData() {
        const loading = document.getElementById('loading');
        const container = document.getElementById('metricsContainer');
        const priceDisplay = document.getElementById('priceDisplay');

        loading.style.display = 'block';
        container.style.display = 'none';

        try {
            const response = await fetch(`/api/stocks/${symbol}/momentum`);
            const data = await response.json();

            if (data.error) {
                throw new Error(data.error);
            }

            displayData(data);
            loading.style.display = 'none';
            container.style.display = 'block';
        } catch (error) {
            loading.innerHTML = `Error: ${error.message}`;
        }
    }

    function displayData(data) {
        // Update price display
        document.getElementById('priceDisplay').innerHTML = `
            <div class="price-label">Current Price</div>
            <div class="price-value">$${data.current_price}</div>
        `;

        const momentumClass = data.momentum_6m >= 0 ? 'positive' : 'negative';
        const momentumSign = data.momentum_6m >= 0 ? '+' : '';

        // Metrics grid
        document.getElementById('metricsGrid').innerHTML = `
            <div class="metric-card">
                <div class="metric-title">üìä Momentum</div>
                <div class="metric-row">
                    <span class="metric-label">6-Month:</span>
                    <span class="metric-value ${momentumClass}">${momentumSign}${data.momentum_6m}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">3-Month:</span>
                    <span class="metric-value">${data.momentum_3m ? data.momentum_3m + '%' : 'N/A'}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">1-Month:</span>
                    <span class="metric-value">${data.momentum_1m ? data.momentum_1m + '%' : 'N/A'}</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">üìà Price Levels</div>
                <div class="metric-row">
                    <span class="metric-label">Current:</span>
                    <span class="metric-value">$${data.current_price}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">6 Months Ago:</span>
                    <span class="metric-value">$${data.price_6mo_ago}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">SMA 20:</span>
                    <span class="metric-value">$${data.sma_20 || 'N/A'}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">SMA 50:</span>
                    <span class="metric-value">$${data.sma_50 || 'N/A'}</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">üìâ Risk</div>
                <div class="metric-row">
                    <span class="metric-label">Volatility:</span>
                    <span class="metric-value">${data.volatility}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Trend Strength:</span>
                    <span class="metric-value">${data.trend_strength}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Data Points:</span>
                    <span class="metric-value">${data.data_points} days</span>
                </div>
            </div>
        `;
    }

    // Load data on page load
    fetchData();
</script>
{% endblock %}